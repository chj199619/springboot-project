YAHOO.namespace("TB.app.security");(function(){var Y=YAHOO.util,D=Y.Dom,E=Y.Event,Lang=Y.Lang;TB.app.hint={hintBox:null,HINT_CONTAINER:"J_HintBox",createHint:function(cls){var hintBox=document.createElement("div");hintBox.className=cls;D.setStyle("position","absolute");var arrow=document.createElement("span");arrow.className="arrow";hintBox.appendChild(arrow);var box=document.createElement("div");box.className="box";hintBox.appendChild(box);var bd=document.createElement("div");bd.id=this.HINT_CONTAINER;bd.className="bd";box.appendChild(bd);hintBox.style.visibility="hidden";document.body.appendChild(hintBox);this.hintBox=hintBox},show:function(x,y,target){var w=this.hintBox.offsetWidth;var h=this.hintBox.offsetHeight;var arrow=D.getElementsByClassName("arrow","",this.hintBox)[0],halfArrow=arrow.offsetWidth/2;arrow.style.left=w/2-halfArrow+"px";D.setX(this.hintBox,x-halfArrow-(w-target.offsetWidth)/2);D.setY(this.hintBox,y+10);D.setStyle(this.hintBox,"visibility","visible")},hide:function(){D.setStyle(this.hintBox,"visibility","hidden")},addEvent:function(cls,delay){var hint=this,hintTimer,hintTimerHide;E.on(document,"mouseover",function(e){if(hintTimer){clearTimeout(hintTimer)}hintTimer=null;var target=E.getTarget(e);formEl=E.getRelatedTarget(e);var hintEl=D.getAncestorByClassName(target,cls);try{if(D.hasClass(target,cls)){hintEl=target}}catch(e){}if(formEl===hintEl){return}if(hintEl){var sourceid=D.getAttribute(hintEl,"sourceID"),dataInfo=D.getAttribute(hintEl,"data-info");if(sourceid&&sourceid.trim()&&D.get(sourceid)){D.get(hint.HINT_CONTAINER).innerHTML=D.get(sourceid).innerHTML}else{if(dataInfo&&dataInfo.trim()){D.get(hint.HINT_CONTAINER).innerHTML=dataInfo}else{D.get(hint.HINT_CONTAINER).innerHTML=hintEl.innerHTML}}var xy=D.getXY(hintEl);hintTimer=setTimeout(function(e){hint.show(xy[0],xy[1],target)},delay)}else{if(D.getAncestorByClassName(target,"hint-box")||D.hasClass(target,"hint-box")){if(hintTimerHide){clearTimeout(hintTimerHide)}hintTimerHide=null;return}else{if(hintTimerHide){clearTimeout(hintTimerHide)}hintTimerHide=null;hintTimerHide=setTimeout(function(e){hint.hide()},delay)}}})},start:function(triggerCls,popCls,delay){this.createHint(popCls);this.addEvent(triggerCls,delay)}};TB.app.emailDredge=function(trigger,queryUrl){var callback={success:function(o){var result=eval("("+o.responseText+")");if(result.success){var aimBtn=typeof(trigger)==="object"?trigger:D.get(trigger);if(!aimBtn){return}try{var stat=D.getPreviousSibling(aimBtn.parentNode);var span=stat.getElementsByTagName("span")[0];if(aimBtn.value.trim()==="\u5173\u95ed"){span.className="alert";span.innerHTML="\u672a\u5f00\u901a";aimBtn.value="\u5f00\u901a"}else{span.className="ok";span.innerHTML="\u5df2\u5f00\u901a";aimBtn.value="\u5173\u95ed"}}catch(e){}}else{alert(result.reason||"\u7f51\u7edc\u95ee\u9898\uff0c\u8bf7\u91cd\u8bd5\uff01")}},failure:function(){alert("\u7f51\u7edc\u95ee\u9898\uff0c\u8bf7\u91cd\u8bd5\uff01")}};YAHOO.util.Connect.asyncRequest("post",queryUrl,callback,null)};TB.app.settingDredge=function(trigger){var ancestor=D.getAncestorByClassName(trigger,"J_AddressBox");if(!ancestor){return}var addrSelect=D.getElementsByClassName("J_AddressSelect","",ancestor);var addrName=D.getElementsByClassName("J_AddressName","",ancestor);D.batch(addrName,function(el){el.style.display="none"});D.batch(addrSelect,function(el){el.style.display=""});trigger.style.display="none";var saveBtn=D.getNextSibling(trigger);if(!saveBtn){return}saveBtn.style.display="";E.on(saveBtn,"click",function(e){E.stopEvent(e);var formEl=D.getAncestorByTagName(saveBtn,"form");formEl.submit()})};TB.app.security.securitySet=function(config){var securityForm=D.get(config.form);E.on(["J_BindMobile","J_BindEmail"],"click",selectBindType);var mobile=securityForm["_fmm.mob._0.n"],email=securityForm["_fmm.pa._0.e"];E.on(mobile,"focus",focusFunc,"\u8bf7\u586b\u5199\u60a8\u5e38\u7528\u7684\u624b\u673a");E.on(mobile,"blur",blurFunc,"\u8bf7\u586b\u5199\u60a8\u5e38\u7528\u7684\u624b\u673a");E.on(email,"focus",focusFunc,"\u8bf7\u586b\u5199\u60a8\u7684\u6709\u6548\u90ae\u7bb1");E.on(email,"blur",blurFunc,"\u8bf7\u586b\u5199\u60a8\u7684\u6709\u6548\u90ae\u7bb1")};TB.app.security.securityCode=function(id,inputMsg){var code=D.get(id);var inputMsg=inputMsg||D.getAttribute(code,"holdmsg")||"";!code.value.trim().length||code.value.trim()===inputMsg?code.value=inputMsg:D.removeClass(code,"gray");E.on(code,"focus",focusFunc,inputMsg);E.on(code,"blur",blurFunc,inputMsg)};var selectBindType=function(e){if(this.id==="J_BindMobile"){D.setStyle("bind-mobile","display","");D.setStyle("bind-email-msg","display","");D.setStyle("bind-email","display","none");D.setStyle("bind-mobile-msg","display","none")}else{D.setStyle("bind-mobile","display","none");D.setStyle("bind-email","display","");D.setStyle("bind-mobile-msg","display","");D.setStyle("bind-email-msg","display","none")}};var focusFunc=function(e,inputMsg){if(this.value.trim()===inputMsg){this.value=""}D.removeClass(this,"gray")};var blurFunc=function(e,inputMsg){if(this.value.trim().length===0){this.value=inputMsg;D.addClass(this,"gray")}};TB.app.security.answerQus=function(wrapID,selectIndexNum){var preIndex=[0,0,0];var selectList=D.getElementsByClassName("select-qus","select",wrapID);var birthTips=D.getElementsByClassName("birthday","span",wrapID);var model=D.get("question-model");var tipsControl=function(j){D.hasClass(selectList[j].options[selectList[j].selectedIndex],"birthday-opt")?D.setStyle(birthTips[j],"display",""):D.setStyle(birthTips[j],"display","none")};var changeEvent=function(e,spec){if(typeof(spec)!="undefined"){preIndex[spec]=selectList[spec].value}for(var i=0,len=selectList.length;i<len;i++){if(i===spec){tipsControl(i);continue}selectList[i].options.length=0;for(var m=0,lens=model.options.length;m<lens;m++){var index=preIndex.indexOf(model.options[m].value);if(index<0||index==i||m==0){selectList[i].options[selectList[i].options.length]=new Option(model.options[m].text,model.options[m].value);selectList[i].options[selectList[i].options.length-1].className=model.options[m].className}}selectList[i].value=preIndex[i];tipsControl(i)}};var init=(function(){if(!model){return}preIndex=selectIndexNum;changeEvent();for(var i=0,len=selectList.length;i<len;i++){E.on(selectList[i],"change",changeEvent,i)}})()};TB.app.security.showTips=function(ob,cls,e){if(!ob){D.get("J_PhoneTipsSub").style.display="block";return}if(ob.rel&&ob.rel.trim().length){D.get("J_PhoneTips").style.display="block";D.get("J_Arror").className="arror "+cls;D.get("J_TipsContent").innerHTML=ob.rel;E.stopEvent(e);return false}};TB.app.security.closeTips=function(ob){var container=D.getAncestorByClassName(ob,"phone-tips");D.setStyle(container,"display","none")};TB.app.security.countDown=function(num,no_count){if(!no_count){var init=function(){var btn=document.getElementById("have-read-btn");btn.disabled=true;var num=num||60;var countDown=function(){num--;document.getElementById("count-down").innerHTML=num;if(num<=0){btn.disabled=false;window.clearInterval(timer)}};var timer=setInterval(countDown,1000)};init()}var successHandler=function(){var msg_box=D.get("J_SendBackMsg");var msg_box_wrap=D.getAncestorByClassName(msg_box,"code-msg");if(TB.app.security.code.stat){msg_box.className="ok";msg_box.innerHTML=TB.app.security.code.msg;if(!no_count){init()}}else{msg_box.className="error";msg_box.innerHTML=TB.app.security.code.msg}msg_box_wrap.style.display="block"};if(this.validateUrl){E.on("have-read-btn","click",function(){YAHOO.util.Get.script(TB.app.security.validateUrl,{onSuccess:successHandler,charset:"gbk",scope:this})})}};TB.app.security.toggleList=function(ob){var list=D.get("J_PhoneList");if(D.hasClass(list,"collepse")){D.removeClass(list,"collepse");ob.className="pinch collapse";return}D.addClass(list,"collepse");ob.className="pinch"};TB.app.security.initProvince=function(selectCls,valCls){if(!TB.form.DistrictSelector._tb_ds_data){return}var select=D.getElementsByClassName(selectCls,"select",document);var selectValue=D.getElementsByClassName(valCls,"input",document);var data=TB.form.DistrictSelector._tb_ds_data;for(var i=0,len=select.length;i<len;i++){for(var code in data){if(isNaN(parseInt(code))){continue}var d=data[code],pid=d[1];if(pid==="1"){select[i].options[select[i].options.length]=new Option(d[0],code)}}select[i].value=selectValue[i].value}}})();
